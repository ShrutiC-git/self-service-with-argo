apiVersion: batch/v1
kind: Job
metadata: { name: __NAME__ } # Corrected metadata syntax
spec:
  template:
    spec:
      serviceAccountName: ai-sa # This should match the SA created by Terraform for the ai-jobs namespace
      restartPolicy: Never
      containers:
      - name: __NAME__
        image: placeholder
        resources: { # This block is required by your Kyverno policy
            requests: {
                memory: 64Mi,
                cpu: 50m
            },
            limits: {
                memory: 128Mi,
                cpu: 100m
            }
        }
        env:
            - name: RABBITMQ_HOST
              value: rabbitmq.messaging.svc.cluster.local
            - name: RABBITMQ_PASSWORD
              valueFrom:
                secretKeyRef:
                    name: rabbitmq-secret
                    key: RABBITMQ_DEFAULT_PASS
            - name: MINIO_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: minio-secrets
                  key: MINIO_ACCESS_KEY
            - name: MINIO_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: minio-secrets
                  key: MINIO_SECRET_KEY
        volumeMounts:
        - { name: artifacts, mountPath: /artifacts }
      volumes:
      - name: artifacts
        persistentVolumeClaim: { claimName: model-artifacts }